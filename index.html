<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InfinAI - Juego</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      background: #333;
      color: white;
      width: 100%;
    }
    nav button {
      background: #555;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 6px;
    }
    nav button:hover {
      background: #777;
    }
    .section { display: none; width: 100%; max-width: 800px; padding: 1rem; }
    #gameSection { display: block; text-align: center; }
    canvas { background: #d0f0ff; border: 2px solid #333; border-radius: 10px; }
    .catalogo-item { border: 1px solid #ccc; padding: 1rem; margin: 0.5rem; border-radius: 8px; background: #fff; }
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 1rem; }
    .card { padding: 1rem; background: white; border-radius: 8px; border: 1px solid #ddd; text-align: center; }
  </style>
</head>
<body>
  <nav>
    <button onclick="showSection('gameSection')">Jugar</button>
    <button onclick="showSection('dataSection')">Datos</button>
    <button onclick="showSection('catalogSection')">Catálogo</button>
  </nav>

  <!-- Juego -->
  <div id="gameSection" class="section">
    <h2>Juego de la Gota</h2>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <p>Puntaje: <span id="score">0</span></p>
  </div>

  <!-- Datos -->
  <div id="dataSection" class="section">
    <h2>Dashboard</h2>
    <div class="dashboard" id="dashboard"></div>
  </div>

  <!-- Catálogo -->
  <div id="catalogSection" class="section">
    <h2>Catálogo</h2>
    <div class="catalogo-item">💧 Filtro de Agua - $500</div>
    <div class="catalogo-item">🔥 Calentador Solar - $3,000</div>
    <div class="catalogo-item">🚿 Regadera Ecológica - $800</div>
  </div>

<script>
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';
  }

  // Juego
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  let score = 0;
  let playing = true;
  let drop = {x: 200, y: 200, r: 15, dx: 0, dy: 0};
  let flame = {x: 50, y: 50, r: 20};
  let objects = [];
  let startTime = Date.now();

  function randomObject() {
    return {x: Math.random()*380, y: Math.random()*380, r:10, visible: true};
  }

  function drawDrop() {
    ctx.fillStyle = "#00f";
    ctx.beginPath();
    ctx.ellipse(drop.x, drop.y, drop.r, drop.r*1.2, 0, 0, Math.PI*2);
    ctx.fill();
  }

  function drawFlame() {
    ctx.fillStyle = "orange";
    ctx.beginPath();
    ctx.moveTo(flame.x, flame.y);
    ctx.quadraticCurveTo(flame.x+10, flame.y-30, flame.x+20, flame.y);
    ctx.quadraticCurveTo(flame.x, flame.y+30, flame.x-20, flame.y);
    ctx.closePath();
    ctx.fill();
  }

  function drawObjects() {
    ctx.fillStyle = "green";
    objects.forEach(o => {
      if(o.visible) {
        ctx.beginPath();
        ctx.arc(o.x, o.y, o.r, 0, Math.PI*2);
        ctx.fill();
      }
    });
  }

  function moveFlame() {
    let dx = drop.x - flame.x;
    let dy = drop.y - flame.y;
    let dist = Math.sqrt(dx*dx+dy*dy);
    if(dist>0){
      flame.x += dx/dist*1.5;
      flame.y += dy/dist*1.5;
    }
  }

  function update() {
    if(!playing) return;
    ctx.clearRect(0,0,400,400);
    drop.x += drop.dx;
    drop.y += drop.dy;
    if(drop.x<drop.r) drop.x=drop.r;
    if(drop.y<drop.r) drop.y=drop.r;
    if(drop.x>400-drop.r) drop.x=400-drop.r;
    if(drop.y>400-drop.r) drop.y=400-drop.r;

    moveFlame();
    drawDrop();
    drawFlame();
    drawObjects();

    // colisiones
    objects.forEach(o=>{
      if(o.visible){
        let dx = drop.x-o.x;
        let dy = drop.y-o.y;
        if(Math.sqrt(dx*dx+dy*dy)<drop.r+o.r){
          o.visible=false;
          score++;
          document.getElementById("score").textContent=score;
        }
      }
    });

    // si llama atrapa
    let dx=drop.x-flame.x, dy=drop.y-flame.y;
    if(Math.sqrt(dx*dx+dy*dy)<drop.r+flame.r){
      playing=false;
      saveGame();
    }

    requestAnimationFrame(update);
  }

  // Controles teclado
  document.addEventListener("keydown", e=>{
    if(e.key==="ArrowUp") drop.dy=-2;
    if(e.key==="ArrowDown") drop.dy=2;
    if(e.key==="ArrowLeft") drop.dx=-2;
    if(e.key==="ArrowRight") drop.dx=2;
  });
  document.addEventListener("keyup", e=>{
    if(["ArrowUp","ArrowDown"].includes(e.key)) drop.dy=0;
    if(["ArrowLeft","ArrowRight"].includes(e.key)) drop.dx=0;
  });

  // Giroscopio
  window.addEventListener("deviceorientation", e=>{
    drop.dx = e.gamma/20;
    drop.dy = e.beta/20;
  });

  // Objetos cada cierto tiempo
  setInterval(()=>{
    if(playing) objects.push(randomObject());
    if(objects.length>20) objects.shift();
  },2000);

  update();

  // Guardar partida
  function saveGame(){
    let duration = (Date.now()-startTime)/1000;
    let data = JSON.parse(localStorage.getItem("games")||"[]");
    data.unshift({score:score, duration:duration, date:new Date().toLocaleString()});
    if(data.length>10) data=data.slice(0,10);
    localStorage.setItem("games",JSON.stringify(data));
    loadDashboard();
  }

  function loadDashboard(){
    let data = JSON.parse(localStorage.getItem("games")||"[]");
    let container = document.getElementById("dashboard");
    container.innerHTML="";
    if(data.length===0){container.innerHTML="<p>No hay datos</p>";return;}
    let avgScore = data.reduce((a,b)=>a+b.score,0)/data.length;
    let avgTime = data.reduce((a,b)=>a+b.duration,0)/data.length;
    container.innerHTML+=`<div class="card">Promedio Puntaje: ${avgScore.toFixed(1)}</div>`;
    container.innerHTML+=`<div class="card">Promedio Duración: ${avgTime.toFixed(1)}s</div>`;
    container.innerHTML+=`<div class="card">Última partida: ${data[0].score} puntos en ${data[0].duration.toFixed(1)}s</div>`;
  }

  loadDashboard();
</script>
</body>
</html>
