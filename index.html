<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda de Vestidos</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f9f9f9; }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        
        .catalogo { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 25px; 
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .producto { 
            background: white; 
            border-radius: 10px; 
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            text-align: center; 
            padding-bottom: 15px;
            transition: transform 0.2s;
        }
        
        .producto:hover { transform: translateY(-5px); }
        
        .producto img { 
            width: 100%; 
            height: 350px; 
            object-fit: cover; 
            border-bottom: 1px solid #eee;
        }
        
        .info { padding: 0 15px; }
        .precio { color: #27ae60; font-weight: bold; font-size: 1.4em; margin: 10px 0; }
        .desc { color: #666; font-size: 0.9em; min-height: 40px;}
        
        .etiqueta {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .disp-ok { background-color: #e8f8f5; color: #27ae60; }
        .disp-low { background-color: #fef9e7; color: #f1c40f; }
        .disp-no { background-color: #fdedec; color: #e74c3c; }

        /* Estilo para mensajes de error */
        #error-box { display:none; background:#xffdd; border:1px solid red; padding:20px; color:red; margin: 20px; }
    </style>
</head>
<body>

    <div id="error-box"></div>

    <h1>Nuestros Vestidos</h1>
    
    <div id="contenedor-productos" class="catalogo">
        <p style="text-align:center; width:100%; font-size:1.2em; color:#666;">
            ⏳ Cargando catálogo desde Google Sheets...
        </p>
    </div>

    <script>
        // --- RED DE SEGURIDAD: Captura errores globales ---
        window.onerror = function(message, source, lineno, colno, error) {
            const box = document.getElementById('error-box');
            box.style.display = 'block';
            box.innerHTML += `<p><strong>Error Detectado:</strong> ${message} <br><small>Línea: ${lineno}</small></p>`;
        };
    </script>

    <script>
        // --- CONFIGURACIÓN ---
        const sheetID = '1oXMJw-h2OwsK37dSOf8vAg7NW6zkEp8yJ6GFkihExD8'; 
        const tabName = 'Sheet1'; // Configurado como 'Sheet1' según tu indicación

        // Usamos una API alternativa (sheetdb o opensheet) si la primera falla, 
        // pero seguiremos con opensheet que es la más rápida.
        const endpoint = `https://opensheet.elk.sh/${sheetID}/${tabName}`;

        async function init() {
            const contenedor = document.getElementById('contenedor-productos');
            
            try {
                // 1. Petición a los datos
                const respuesta = await fetch(endpoint);
                
                if (!respuesta.ok) {
                    throw new Error(`No se pudo conectar (Status: ${respuesta.status}). Revisa los permisos de la hoja.`);
                }

                const datos = await respuesta.json();

                // 2. Verificación si hay error en el JSON devuelto
                if (datos.error) throw new Error(datos.error);
                
                // 3. Limpiamos el cargando
                contenedor.innerHTML = '';

                // 4. Renderizamos los productos
                let productosEncontrados = 0;

                datos.forEach(item => {
                    // FILTRO: Si no tiene nombre, ignoramos la fila (para evitar las filas vacías que vimos)
                    if (!item['NOMBRE']) return;

                    productosEncontrados++;

                    // Lógica de disponibilidad (colores y textos)
                    let dispText = item['DISPONIBILIDAD'] || 'Consultar';
                    let dispClass = 'disp-ok';
                    
                    const dispUpper = dispText.toUpperCase();
                    if (dispUpper.includes('AGOTADO')) dispClass = 'disp-no';
                    else if (dispUpper.includes('ULTIMAS') || dispUpper.includes('PIEZAS')) dispClass = 'disp-low';

                    // Tarjeta HTML
                    const tarjeta = `
                        <div class="producto">
                            <img src="${item['NOMBRE IMG']}" alt="${item['NOMBRE']}" 
                                 onerror="this.onerror=null;this.src='https://via.placeholder.com/300x350?text=Imagen+No+Cargada';">
                            <div class="info">
                                <h3>${item['NOMBRE']}</h3>
                                <p class="desc">${item['DESCRIPCION'] || ''}</p>
                                <p class="precio">$${item['PRECIO']}</p>
                                <span class="etiqueta ${dispClass}">${dispText}</span>
                            </div>
                        </div>
                    `;
                    contenedor.innerHTML += tarjeta;
                });

                if (productosEncontrados === 0) {
                    contenedor.innerHTML = '<p style="text-align:center">No se encontraron productos en la hoja.</p>';
                }

            } catch (err) {
                console.error(err);
                // Mostramos el error en pantalla amigablemente
                const box = document.getElementById('error-box');
                box.style.display = 'block';
                box.innerHTML = `
                    <h3>⚠️ Ocurrió un problema</h3>
                    <p>Detalle: ${err.message}</p>
                    <p>Sugerencia: Verifica que el archivo de Google Sheets tenga acceso "Público" o "Cualquiera con el enlace".</p>
                `;
                contenedor.innerHTML = '';
            }
        }

        // Ejecutar cuando cargue la página
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

