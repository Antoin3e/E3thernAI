<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda de Vestidos</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f9f9f9; }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        
        .catalogo { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 25px; 
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .producto { 
            background: white; 
            border-radius: 10px; 
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            text-align: center; 
            padding-bottom: 15px;
        }
        
        .producto img { 
            width: 100%; 
            height: 350px; 
            object-fit: cover; 
            border-bottom: 1px solid #eee;
            background-color: #eaeaea; /* Fondo gris mientras carga */
        }
        
        .info { padding: 0 15px; }
        .precio { color: #27ae60; font-weight: bold; font-size: 1.4em; margin: 10px 0; }
        .etiqueta { padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold; display: inline-block; margin-bottom:10px;}
        .disp-ok { background-color: #e8f8f5; color: #27ae60; }
        .disp-no { background-color: #fdedec; color: #e74c3c; }
        .disp-low { background-color: #fef9e7; color: #f1c40f; }
    </style>
</head>
<body>

    <h1>Nuestros Vestidos</h1>
    <div id="contenedor-productos" class="catalogo">
        <p style="text-align:center; width:100%">Cargando...</p>
    </div>

    <script>
        const sheetID = '1oXMJw-h2OwsK37dSOf8vAg7NW6zkEp8yJ6GFkihExD8'; 
        const tabName = 'Sheet1'; 
        const endpoint = `https://opensheet.elk.sh/${sheetID}/${tabName}`;

        async function init() {
            const contenedor = document.getElementById('contenedor-productos');
            try {
                const respuesta = await fetch(endpoint);
                const datos = await respuesta.json();
                
                contenedor.innerHTML = ''; // Limpiar cargando

                datos.forEach(item => {
                    if (!item['NOMBRE']) return; // Saltar filas vacías

                    // --- LIMPIEZA DE DATOS ---
                    // 1. Quitamos espacios extra al nombre de la imagen con .trim()
                    // 2. Si la celda está vacía, ponemos un nombre falso para que no rompa
                    const rawImg = item['NOMBRE IMG'] || '';
                    const nombreImagen = rawImg.trim(); 

                    // Lógica de disponibilidad
                    let dispText = item['DISPONIBILIDAD'] || 'Consultar';
                    let dispClass = 'disp-ok';
                    if (dispText.toUpperCase().includes('AGOTADO')) dispClass = 'disp-no';
                    else if (dispText.toUpperCase().includes('ULTIMAS')) dispClass = 'disp-low';

                    const tarjeta = `
                        <div class="producto">
                            <img src="${nombreImagen}" 
                                 alt="${item['NOMBRE']}"
                                 onerror="this.onerror=null;this.src='https://via.placeholder.com/300?text=Error+Imagen'; console.log('Falló al cargar: ${nombreImagen}')">
                            <div class="info">
                                <h3>${item['NOMBRE']}</h3>
                                <p>${item['DESCRIPCION'] || ''}</p>
                                <p class="precio">$${item['PRECIO']}</p>
                                <span class="etiqueta ${dispClass}">${dispText}</span>
                            </div>
                        </div>
                    `;
                    contenedor.innerHTML += tarjeta;
                });
            } catch (err) {
                console.error(err);
                contenedor.innerHTML = '<p>Error cargando datos. Revisa la consola.</p>';
            }
        }
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
